{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "output-schema.json",
  "title": "ISD Agent 출력 스키마",
  "description": "교수설계 Agent가 생성하는 ADDIE 기반 출력의 JSON 스키마",
  "type": "object",
  "required": [
    "scenario_id",
    "agent_id",
    "timestamp",
    "addie_output",
    "metadata"
  ],
  "properties": {
    "scenario_id": {
      "type": "string",
      "description": "시나리오 고유 식별자",
      "pattern": "^(EASY|MEDIUM|HARD)-[0-9]{3}$"
    },
    "agent_id": {
      "type": "string",
      "description": "Agent 식별자",
      "enum": [
        "eduplanner",
        "baseline-solarpro2",
        "react-isd"
      ]
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "생성 시각"
    },
    "addie_output": {
      "type": "object",
      "description": "ADDIE 5단계 산출물",
      "required": [
        "analysis",
        "design",
        "development",
        "implementation",
        "evaluation"
      ],
      "properties": {
        "analysis": {
          "$ref": "#/definitions/analysis"
        },
        "design": {
          "$ref": "#/definitions/design"
        },
        "development": {
          "$ref": "#/definitions/development"
        },
        "implementation": {
          "$ref": "#/definitions/implementation"
        },
        "evaluation": {
          "$ref": "#/definitions/evaluation"
        }
      }
    },
    "trajectory": {
      "$ref": "trajectory_schema.json"
    },
    "metadata": {
      "$ref": "#/definitions/metadata"
    }
  },
  "definitions": {
    "analysis": {
      "type": "object",
      "description": "분석 단계 산출물",
      "required": [
        "learner_analysis",
        "context_analysis",
        "task_analysis"
      ],
      "properties": {
        "learner_analysis": {
          "type": "object",
          "description": "학습자 분석",
          "required": [
            "target_audience"
          ],
          "properties": {
            "target_audience": {
              "type": "string",
              "description": "학습 대상"
            },
            "characteristics": {
              "type": "array",
              "description": "학습자 특성",
              "items": {
                "type": "string"
              }
            },
            "prior_knowledge": {
              "type": "string",
              "description": "사전 지식"
            },
            "learning_preferences": {
              "type": "array",
              "description": "학습 선호도",
              "items": {
                "type": "string"
              }
            },
            "motivation": {
              "type": "string",
              "description": "학습 동기"
            },
            "challenges": {
              "type": "array",
              "description": "예상 어려움",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "context_analysis": {
          "type": "object",
          "description": "환경 분석",
          "properties": {
            "environment": {
              "type": "string",
              "description": "학습 환경"
            },
            "duration": {
              "type": "string",
              "description": "학습 시간"
            },
            "constraints": {
              "type": "array",
              "description": "제약 조건",
              "items": {
                "type": "string"
              }
            },
            "resources": {
              "type": "array",
              "description": "가용 자원",
              "items": {
                "type": "string"
              }
            },
            "technical_requirements": {
              "type": "array",
              "description": "기술적 요구사항",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "task_analysis": {
          "type": "object",
          "description": "과제 분석",
          "properties": {
            "main_topics": {
              "type": "array",
              "description": "주요 주제",
              "items": {
                "type": "string"
              }
            },
            "subtopics": {
              "type": "array",
              "description": "세부 주제",
              "items": {
                "type": "string"
              }
            },
            "prerequisites": {
              "type": "array",
              "description": "선수 학습",
              "items": {
                "type": "string"
              }
            },
            "knowledge_structure": {
              "type": "object",
              "description": "지식 구조"
            }
          }
        }
      }
    },
    "design": {
      "type": "object",
      "description": "설계 단계 산출물",
      "required": [
        "learning_objectives",
        "instructional_strategy"
      ],
      "properties": {
        "learning_objectives": {
          "type": "array",
          "description": "학습 목표",
          "items": {
            "type": "object",
            "required": [
              "id",
              "statement"
            ],
            "properties": {
              "id": {
                "type": "string",
                "description": "목표 ID",
                "pattern": "^LO-[0-9]{3}$"
              },
              "level": {
                "type": "string",
                "description": "Bloom's Taxonomy 수준",
                "enum": [
                  "기억",
                  "이해",
                  "적용",
                  "분석",
                  "평가",
                  "창조"
                ]
              },
              "statement": {
                "type": "string",
                "description": "목표 진술문"
              },
              "bloom_verb": {
                "type": "string",
                "description": "Bloom's Taxonomy 행동 동사"
              },
              "measurable": {
                "type": "boolean",
                "description": "측정 가능 여부"
              }
            }
          }
        },
        "assessment_plan": {
          "type": "object",
          "description": "평가 계획",
          "properties": {
            "formative": {
              "type": "array",
              "description": "형성 평가",
              "items": {
                "type": "string"
              }
            },
            "summative": {
              "type": "array",
              "description": "총괄 평가",
              "items": {
                "type": "string"
              }
            },
            "diagnostic": {
              "type": "array",
              "description": "진단 평가",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "instructional_strategy": {
          "type": "object",
          "description": "교수 전략",
          "properties": {
            "model": {
              "type": "string",
              "description": "교수 모델",
              "examples": [
                "Gagné's 9 Events",
                "ARCS",
                "4C/ID"
              ]
            },
            "sequence": {
              "type": "array",
              "description": "교수 순서",
              "items": {
                "type": "object",
                "properties": {
                  "event": {
                    "type": "string"
                  },
                  "activity": {
                    "type": "string"
                  },
                  "duration": {
                    "type": "string"
                  },
                  "resources": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "methods": {
              "type": "array",
              "description": "교수 방법",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "development": {
      "type": "object",
      "description": "개발 단계 산출물",
      "required": [
        "lesson_plan",
        "materials"
      ],
      "properties": {
        "lesson_plan": {
          "type": "object",
          "description": "레슨 플랜",
          "required": [
            "total_duration",
            "modules"
          ],
          "properties": {
            "total_duration": {
              "type": "string",
              "description": "총 소요 시간"
            },
            "modules": {
              "type": "array",
              "description": "모듈 목록",
              "items": {
                "type": "object",
                "required": [
                  "title",
                  "duration",
                  "activities"
                ],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "모듈 제목"
                  },
                  "duration": {
                    "type": "string",
                    "description": "소요 시간"
                  },
                  "objectives": {
                    "type": "array",
                    "description": "관련 학습 목표 ID",
                    "items": {
                      "type": "string"
                    }
                  },
                  "activities": {
                    "type": "array",
                    "description": "활동 목록",
                    "items": {
                      "type": "object",
                      "properties": {
                        "time": {
                          "type": "string"
                        },
                        "activity": {
                          "type": "string"
                        },
                        "description": {
                          "type": "string"
                        },
                        "resources": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "materials": {
          "type": "array",
          "description": "학습 자료 목록",
          "items": {
            "type": "object",
            "required": [
              "type",
              "title"
            ],
            "properties": {
              "type": {
                "type": "string",
                "description": "자료 유형",
                "enum": [
                  "PPT",
                  "동영상",
                  "퀴즈",
                  "워크시트",
                  "핸드아웃",
                  "시뮬레이션",
                  "게임"
                ]
              },
              "title": {
                "type": "string",
                "description": "자료 제목"
              },
              "description": {
                "type": "string",
                "description": "자료 설명"
              },
              "slides": {
                "type": "integer",
                "description": "슬라이드 수 (PPT인 경우)"
              },
              "duration": {
                "type": "string",
                "description": "재생 시간 (동영상인 경우)"
              },
              "questions": {
                "type": "integer",
                "description": "문항 수 (퀴즈인 경우)"
              },
              "pages": {
                "type": "integer",
                "description": "페이지 수"
              },
              "slide_contents": {
                "type": "array",
                "description": "슬라이드별 상세 콘텐츠 (PPT인 경우)",
                "items": {
                  "type": "object",
                  "required": ["slide_number", "title", "bullet_points"],
                  "properties": {
                    "slide_number": {
                      "type": "integer",
                      "description": "슬라이드 번호"
                    },
                    "title": {
                      "type": "string",
                      "description": "슬라이드 제목"
                    },
                    "bullet_points": {
                      "type": "array",
                      "description": "핵심 내용 (3-5개)",
                      "items": {
                        "type": "string"
                      }
                    },
                    "speaker_notes": {
                      "type": "string",
                      "description": "발표자 노트"
                    },
                    "visual_suggestion": {
                      "type": "string",
                      "description": "권장 시각 자료"
                    }
                  }
                }
              }
            }
          }
        },
        "storyboard": {
          "type": "object",
          "description": "스토리보드 (선택)"
        }
      }
    },
    "implementation": {
      "type": "object",
      "description": "실행 단계 산출물",
      "properties": {
        "delivery_method": {
          "type": "string",
          "description": "전달 방식"
        },
        "facilitator_guide": {
          "type": "string",
          "description": "진행자 가이드"
        },
        "learner_guide": {
          "type": "string",
          "description": "학습자 가이드"
        },
        "technical_requirements": {
          "type": "array",
          "description": "기술 요구사항",
          "items": {
            "type": "string"
          }
        },
        "support_plan": {
          "type": "string",
          "description": "지원 계획"
        },
        "schedule": {
          "type": "object",
          "description": "일정"
        }
      }
    },
    "evaluation": {
      "type": "object",
      "description": "평가 단계 산출물",
      "properties": {
        "quiz_items": {
          "type": "array",
          "description": "퀴즈 문항",
          "items": {
            "type": "object",
            "required": [
              "id",
              "question",
              "type"
            ],
            "properties": {
              "id": {
                "type": "string",
                "description": "문항 ID"
              },
              "question": {
                "type": "string",
                "description": "질문"
              },
              "type": {
                "type": "string",
                "description": "문항 유형",
                "enum": [
                  "객관식",
                  "주관식",
                  "OX",
                  "단답형",
                  "서술형"
                ]
              },
              "options": {
                "type": "array",
                "description": "선택지 (객관식인 경우)",
                "items": {
                  "type": "string"
                }
              },
              "answer": {
                "type": "string",
                "description": "정답"
              },
              "explanation": {
                "type": "string",
                "description": "해설"
              },
              "objective_id": {
                "type": "string",
                "description": "관련 학습 목표 ID"
              },
              "difficulty": {
                "type": "string",
                "enum": [
                  "쉬움",
                  "보통",
                  "어려움"
                ]
              }
            }
          }
        },
        "rubric": {
          "type": "object",
          "description": "평가 루브릭",
          "properties": {
            "criteria": {
              "type": "array",
              "description": "평가 기준",
              "items": {
                "type": "string"
              }
            },
            "levels": {
              "type": "object",
              "description": "수준별 기준"
            }
          }
        },
        "feedback_plan": {
          "type": "string",
          "description": "피드백 계획"
        },
        "program_evaluation": {
          "type": "object",
          "description": "프로그램 평가 계획",
          "properties": {
            "kirkpatrick_levels": {
              "type": "array",
              "description": "Kirkpatrick 평가 수준",
              "items": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 4
                  },
                  "name": {
                    "type": "string"
                  },
                  "method": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "메타데이터",
      "required": [
        "model",
        "execution_time_seconds"
      ],
      "properties": {
        "model": {
          "type": "string",
          "description": "사용된 LLM 모델"
        },
        "total_tokens": {
          "type": "integer",
          "description": "총 토큰 수"
        },
        "prompt_tokens": {
          "type": "integer",
          "description": "프롬프트 토큰 수"
        },
        "completion_tokens": {
          "type": "integer",
          "description": "완료 토큰 수"
        },
        "execution_time_seconds": {
          "type": "number",
          "description": "실행 시간 (초)"
        },
        "cost_usd": {
          "type": "number",
          "description": "비용 (USD)"
        },
        "agent_version": {
          "type": "string",
          "description": "Agent 버전"
        },
        "iterations": {
          "type": "integer",
          "description": "반복 횟수 (EduPlanner의 경우)"
        }
      }
    }
  }
}